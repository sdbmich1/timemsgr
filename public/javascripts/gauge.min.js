/*
 * Jsgauge 0.4.1
 * http://code.google.com/p/jsgauge/
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 */
function Gauge(e,d){var g=this;this.canvas=e;d=d||{};this.settings={value:d.value||0,pointerValue:d.value||0,label:d.label||"",unitsLabel:d.unitsLabel||"",min:d.min||0,max:d.max||100,majorTicks:d.majorTicks||5,minorTicks:d.minorTicks||2,bands:[].concat(d.bands||[]),greenFrom:[].concat(d.greenFrom||0),greenTo:[].concat(d.greenTo||0),yellowFrom:[].concat(d.yellowFrom||0),yellowTo:[].concat(d.yellowTo||0),redFrom:[].concat(d.redFrom||0),redTo:[].concat(d.redTo||0)};function b(l){var j,k=l.max-l.min,o=k/100,n;if(l.pointerValue>l.max){l.pointerValue=l.max}else{if(l.pointerValue<l.min){l.pointerValue=l.min}}n={min:0,max:100,value:(l.value-l.min)/o,pointerValue:(l.pointerValue-l.min)/o,label:l.label||"",greenFrom:[],greenTo:[],yellowFrom:[],yellowTo:[],redFrom:[],redTo:[],bands:[],majorTicks:Math.max(2,l.majorTicks),minorTicks:Math.max(0,l.minorTicks),decimals:Math.max(0,3-(l.max-l.min).toFixed(0).length)};for(j=l.bands.length;j--;){var m=l.bands[j];n.bands[j]={color:m.color,from:(m.from-l.min)/o,to:(m.to-l.min)/o}}return n}this.colors={text:d.colorOfText||"rgb(0, 0, 0)",warningText:d.colorOfWarningText||"rgb(255, 0, 0)",fill:d.colorOfFill||["#111","#ccc","#ddd","#eee"],pointerFill:d.colorOfPointerFill||"rgba(255, 100, 0, 0.7)",pointerStroke:d.colorOfPointerStroke||"rgba(255, 100, 100, 0.9)",centerCircleFill:d.colorOfCenterCircleFill||"rgba(0, 100, 255, 1)",centerCircleStroke:d.colorOfCenterCircleStroke||"rgba(0, 0, 255, 1)",redBand:d.colorOfRedBand||d.redColor||"rgba(255, 0, 0, 0.2)",yelBand:d.colorOfYellowBand||d.yellowColor||"rgba(255, 215, 0, 0.2)",grnBand:d.colorOfGreenBand||d.greenColor||"rgba(0, 255, 0, 0.2)"};for(var f=this.settings.redFrom.length;f--;){this.settings.bands.push({color:this.colors.redBand,from:this.settings.redFrom[f],to:this.settings.redTo[f]})}for(f=this.settings.yellowFrom.length;f--;){this.settings.bands.push({color:this.colors.yelBand,from:this.settings.yellowFrom[f],to:this.settings.yellowTo[f]})}for(f=this.settings.greenFrom.length;f--;){this.settings.bands.push({color:this.colors.grnBand,from:this.settings.greenFrom[f],to:this.settings.greenTo[f]})}this.relSettings=b(this.settings);function h(i,j){i.font=j;i.mozTextStyle=j}function a(i,j){if(i.measureText){return i.measureText(j).width}else{if(i.mozMeasureText){return i.mozMeasureText(j)}}throw"measureText() not supported!"}function c(k,m,j,i){var l;if(k.fillText){return k.fillText(m,j,i)}else{if(k.mozDrawText){k.save();k.translate(j,i);l=k.mozDrawText(m);k.restore();return l}}throw"fillText() not supported!"}this.drawBackground=function(){var l=g.colors.fill,j=[this.radius,this.radius-1,this.radius*0.98,this.radius*0.95],k;this.c2d.rotate(this.startDeg);for(k=0;k<l.length;k++){this.c2d.fillStyle=l[k];this.c2d.beginPath();this.c2d.arc(0,0,j[k],0,this.spanDeg,false);this.c2d.fill()}};this.drawRange=function(l,k,j){if(k>l){var i=this.spanDeg*(k-l)/100;this.c2d.rotate(this.startDeg);this.c2d.fillStyle=j;this.c2d.rotate(this.spanDeg*l/100);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.arc(0,0,this.outerRadius,0,i,false);this.c2d.rotate(i);this.c2d.lineTo(this.innerRadius,0);this.c2d.arc(0,0,this.innerRadius,0,-i,true);this.c2d.fill()}};this.drawTicks=function(p,l){var o,n,k;this.c2d.rotate(this.startDeg);this.c2d.lineWidth=this.radius*0.025;o=this.spanDeg/(p-1);for(n=0;n<p;n++){this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke();if(n+1<p){this.c2d.save();this.c2d.lineWidth=this.radius*0.01;var m=o/(l+1);for(k=0;k<l;k++){this.c2d.rotate(m);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius+(this.outerRadius-this.innerRadius)/3,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke()}this.c2d.restore()}this.c2d.rotate(o)}};this.drawPointer=function(i){function j(k){k.c2d.beginPath();k.c2d.moveTo(-k.radius*0.2,0);k.c2d.lineTo(0,k.radius*0.05);k.c2d.lineTo(k.radius*0.8,0);k.c2d.lineTo(0,-k.radius*0.05);k.c2d.lineTo(-k.radius*0.2,0)}this.c2d.rotate(this.startDeg);this.c2d.rotate(this.spanDeg*i/100);this.c2d.lineWidth=this.radius*0.015;this.c2d.fillStyle=g.colors.pointerFill;j(this);this.c2d.fill();this.c2d.strokeStyle=g.colors.pointerStroke;j(this);this.c2d.stroke();this.c2d.fillStyle=g.colors.centerCircleFill;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.fill();this.c2d.strokeStyle=g.colors.centerCircleStroke;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.stroke()};this.drawCaption=function(j){if(j){var m=this.radius/5;h(this.c2d,m.toFixed(0)+"px sans-serif");var l=a(this.c2d,j);this.c2d.fillStyle=g.colors.text;var k=-l/2;var i=-this.radius*0.4+m/2;c(this.c2d,j,k,i)}};this.drawValues=function(l,o,p,k){var i,q,n,m;function j(t,r){var s=t.toFixed(r);while((r>0)&&s.match(/^\d+\.(\d+)?0$/)){r-=1;s=t.toFixed(r)}return s}m=j(p,k)+g.settings.unitsLabel;q=this.radius/5;h(this.c2d,q.toFixed(0)+"px sans-serif");n=a(this.c2d,m);if(p<l||p>o){this.c2d.fillStyle=g.colors.warningText}else{this.c2d.fillStyle=g.colors.text}c(this.c2d,m,-n/2,this.radius*0.72);this.save();i=Math.PI*14.5/8;this.c2d.translate(this.radius*0.65*Math.sin(i),this.radius*0.65*Math.cos(i));q=this.radius/8;h(this.c2d,q.toFixed(0)+"px sans-serif");this.c2d.fillStyle=g.colors.text;c(this.c2d,j(l,k),0,0);this.restore();this.save();i=Math.PI*17.5/8;this.c2d.translate(this.radius*0.65*Math.sin(i),this.radius*0.65*Math.cos(i));q=this.radius/8;h(this.c2d,q.toFixed(0)+"px sans-serif");n=a(this.c2d,j(o,k));this.c2d.fillStyle=g.colors.text;c(this.c2d,j(o,k),-n,0);this.restore()};this.draw();return this}Gauge.prototype.setValue=function(e){var d=this,c=(e>d.settings.max)?d.settings.max:(e<d.settings.min)?d.settings.min:e,a=Math.abs(d.settings.pointerValue-c)/20;function b(){var f;if(d.settings.pointerValue<c){d.settings.pointerValue+=a;if(d.settings.pointerValue+a>=c){d.settings.pointerValue=c}}else{d.settings.pointerValue-=a;if(d.settings.pointerValue-a<=c){d.settings.pointerValue=c}}f=d.settings.max-d.settings.min;d.relSettings.pointerValue=(d.settings.pointerValue-d.settings.min)/(f/100);d.draw();if(d.settings.pointerValue!=c){setTimeout(b,50)}}if(!isNaN(e)&&this.settings.value!==e){this.settings.value=e;b()}};Gauge.prototype.draw=function(){var c,b,f;if(!this.canvas.getContext){return}var d={c2d:this.canvas.getContext("2d"),startDeg:Math.PI*5.5/8,spanDeg:Math.PI*13/8,save:function(){this.c2d.save()},restore:function(){this.c2d.restore()},call:function(h){var g=Array.prototype.slice.call(arguments);this.save();this.translateCenter();h.apply(this,g.slice(1));this.restore()},clear:function(){this.c2d.clearRect(0,0,this.width,this.height)},translateCenter:function(){this.c2d.translate(this.centerX,this.centerY)}};d.width=d.c2d.canvas.width;d.height=d.c2d.canvas.height;d.radius=Math.min(d.width/2-4,d.height/2-4);d.innerRadius=d.radius*0.7;d.outerRadius=d.radius*0.9;d.centerX=d.radius+4;d.centerY=d.radius+4+(d.radius-d.radius*Math.sin(d.startDeg))/2;d.clear();d.call(this.drawBackground);for(var a=this.relSettings.bands.length;a--;){var e=this.relSettings.bands[a];d.call(this.drawRange,e.from,e.to,e.color)}d.call(this.drawTicks,this.relSettings.majorTicks,this.relSettings.minorTicks);d.call(this.drawPointer,this.relSettings.pointerValue);d.call(this.drawCaption,this.relSettings.label);d.call(this.drawValues,this.settings.min,this.settings.max,this.settings.value,this.relSettings.decimals)};